# -*- coding: utf-8 -*-
"""
Created on Wed Mar 18 06:26:25 2015

@author: Alex

this paper is different than the Fagaalu-SSY paper because the figures are combined with figures from a collaborator
in this case the figures are generated by other scripts and manually combined with the collaborators figures
these cannot be automated but the scripts have README's associated with the figures.

"""
#### Import modules
## Data Processing
import os
import numpy as np
import pandas as pd
#import math
import datetime as dt
import matplotlib.pyplot as plt
#### Plotting Tools
import matplotlib.pyplot as plt
import matplotlib as mpl
plt.ioff()
plt.close('all')

## Python docx
from docx import *
from docx.shared import Inches
from docx.shared import Pt
from docx.enum.text import WD_ALIGN_PARAGRAPH

## Set Directories
git=True
if git==True: ## Git repository
    maindir = 'C:/Users/Alex/Documents/GitHub/Faga-alu-Bay-water-circulation/' 
    datadir=maindir+'Data/'
    trackdir = maindir+'Data/AllTracks/'
    GISdir = maindir+'Data/DriftersGIS/'
    figdir = maindir+'Figures/fromAlex/'
    dirs={'main':maindir,'data':datadir,'track':trackdir,'GIS':GISdir,'fig':figdir}
elif git!=True: ## Local folders
    datadir = 'C:/Users/Alex/Desktop/'
    trackdir = 'samoa/DRIFTERS/AllTracks/'


##  Create Document
document = Document()

######## SOME TOOLS
def add_figure_caption(fig_num=str(len(document.inline_shapes)),caption=''):
    cap = document.add_paragraph("Figure "+fig_num+". "+caption)
    cap.paragraph_style = 'caption'
    return
    
def dataframe_to_table(df=pd.DataFrame(),table_num=str(len(document.tables)+1),caption='',fontsize=11):
    table = document.add_table(rows=1, cols=len(df.columns)) 
    ## Merge all cells in top row and add caption text
    table_caption = table.rows[0].cells[0].merge(table.rows[0].cells[len(df.columns)-1])
    table_caption.text = "Table "+table_num+". "+caption
    ## Add  header
    header_row = table.add_row().cells
    col_count =0 ## counter  to iterate over columns
    for col in  header_row:
        col.text = df.columns[col_count] #df.columns[0] is the index
        col_count+=1
    ## Add data by  iterating over the DataFrame rows, then using a dictionary of DataFrame column labels to extract data
    col_labels = dict(zip(range(len(df.columns)),df.columns.tolist())) ## create dictionary where '1  to  n' is key for DataFrame columns
    for row in df.iterrows():  ## iterate over  rows in  DataFrame
        #print row[1]
        row_cells = table.add_row().cells ## Add a row to the  table
        col_count  = 0
        for cell in row_cells: ## iterate over the columns in the row
            #print row[1][str(col_labels[col_count])]
            cell.text = str(row[1][str(col_labels[col_count])]) ## and plug in data using a dictionary to  get column labels for DataFrame
            col_count+=1
    ## Format Table Style  
    table.style = 'TableGrid' 
    table.style.font.size = Pt(fontsize)
    table.autofit
    #table.num = str(len(document.tables)+1)
    return table
    
def add_equation(eq_table):
    t = document.add_table(rows=len(eq_table.rows),cols=len(eq_table.columns))
    t.rows[0].cells[1].text = eq_table.rows[0].cells[1].text
    t.rows[0].cells[2].text = eq_table.rows[0].cells[2].text   
    if len(eq_table.rows)>1:
        t.rows[1].cells[0].merge(t.rows[1].cells[2]).text = eq_table.rows[1].cells[0].text
    t.style = 'TableGrid'   
    t.autofit
    return t
###################################################################################################################################################################    


#### TABLES ########################################################################################################################################################
### Landcover_Table
table_count=0
def tab_count():
    global table_count
    table_count+=1
    return str(table_count)
    
## End member definitions
def Endmember_definitions_table():
    XL = pd.ExcelFile(datadir+'Drifter deployment checklist.xlsx')
    endmember_table = XL.parse('EndmemberDefn',header=0,index_col=0,parse_cols='A:D',parse_dates=False)
    endmember_table['End member']=endmember_table.index
    endmember_table = endmember_table[['End member','Julian Day', 'Gregorian Day (UTC)','Gregorian Day (Local)']]
    return endmember_table  
Endmember_table = Endmember_definitions_table()
Endmember_table.table_num = str(tab_count())    
    
## Drifter deployment dates
def Drifter_deployments_table():
    XL = pd.ExcelFile(datadir+'Drifter deployment checklist.xlsx')
    deployment_table = XL.parse('Table',header=1,index_col=0,parse_cols='C:P',parse_dates=False)
    deployment_table['Deployment'] = deployment_table.index
    deployment_table['Date'] = deployment_table['Date'].apply(lambda x: "{:%m/%d/%Y}".format(x))
    deployment_table['Tide Start'] = deployment_table['Tide Start'].round(1)
    deployment_table['Tide End'] = deployment_table['Tide End'].round(1)
    deployment_table['Tide movement'] = deployment_table['Tide movement'].round(1)
    deployment_table['Wind Speed Avg'] = deployment_table['Wind Speed Avg'].round(1)
    deployment_table['Wind Direction Avg'] = deployment_table['Wind Direction Avg'].round(0)
    deployment_table['Wind Gust Max'] = deployment_table['Wind Gust Max'].round(0)
    deployment_table= deployment_table[['Deployment','Julian(local)', 'Date', 'Start Time', 'End Time', 'Tide Start', 'Tide End', 'Tide movement', 'Tide', 'Wind Speed Avg', 'Wind Direction Avg', 'Wind Gust Max', 'Wave Height(m)', 'Wave Period']]
    return deployment_table
Drifter_deployment_table = Drifter_deployments_table()
Drifter_deployment_table.table_num = str(tab_count())    


#### FIGURES ########################################################################################################################################################
figure_count=0
def fig_count():
    global figure_count
    figure_count+=1
    return str(figure_count)
    
## INTRODUCTION
#### Study Area Map
Study_Area_map = {'filename':maindir+'Figures/Maps/Fagaalu_water_circulation_study_area.tif', 'fig_num':str(fig_count())}

### Pics of Drifters and ADCP's
Drifter_ADCP_pics = {'filename':maindir+'Figures/Maps/Drifter_ADCP_pics.tif', 'fig_num':str(fig_count())}

### Forcing data
Forcing_data_timeseries = {'filename':maindir+'Figures/Forcing/AmSam_ADCPdrifter_Fig_3_forcing.png', 'fig_num':str(fig_count())}

### ADCP measurements
ADCP_measurements = {'filename':maindir+'Figures/ADCP measurements/Figure4_ADCP.png', 'fig_num':str(fig_count())}

### Progressive Vectors vs drifter tracks
Progressive_Vectors_ADCP_vs_Drifters = {'filename':maindir+'Figures/Progressive Vectors/Figure6_progvec_driftervelocity.png', 'fig_num':str(fig_count())}

### Gridded velocity by endmember
Gridded_Velocity_endmembers = {'filename':maindir+'Figures/Gridded velocity endmembers/Fagaalu_velocity-endmembers.png', 'fig_num':str(fig_count())}

## Gridded PCA by endmember
PCA_gridded = {'filename':maindir+'Figures/Gridded PCA endmembers/Figure7_paxes_map_OMC.png', 'fig_num':str(fig_count())}

###### EQUATIONS ############################################################################################################################################
equation_count=0
def eq_count():
    global equation_count
    equation_count+=1
    return str(equation_count)
    
#Equations = Document(maindir+'/Manuscript/Equations.docx').tables
#
### SSYev = Q*SSC 
#Equation_one = Equations[0].table
#Equation_one.eq_num = eq_count()

##### APPENDIX #################################################################################################################################
#### Appendix
table_count,figure_count,equation_count=0, 0, 0
### Appendix Table One
#Appendix_table_one = table_function() ## function to create table data
#Appendix_table_one.table_num =str(tab_count())

############################################################################################################################################

#### TITLE
title_title = document.add_heading('TITLE:',level=1)
title_title.paragraph_format.space_before = 0
title = document.add_heading("Eulerian and Lagrangian measurements of flow and residence time on a fringing reef flat embayment, American Samoa",level=1)
title.paragraph_format.space_before = 0
## subscript/superscript words
document.add_paragraph("")

#### ABSTRACT
abstract_title = document.add_heading('ABSTRACT',level=2)
abstract_title.paragraph_format.alignment = WD_ALIGN_PARAGRAPH.CENTER
abstract = document.add_paragraph('Abstract text goes here....')


#### INTRODUCTION
introduction_title = document.add_heading('Introduction',level=2)
document.add_paragraph("Hydrodynamic conditions, including the residence time of waters over the reef flat, are a primary control on sediment dynamics in fringing reef embayments (Draut et al., 2009; Storlazzi et al., 2009), and are important for other biologically important processes like nutrient cycling, larval dispersal, and temperature regimes (Falter et al., 2004; Wyatt et al., 2012). Current conservation planning is done with coarse estimations of pollutant discharge and distance-based plume models (Klein et al., 2012) but coral reef environments are more hydrodynamically complex and variable than estuaries or beaches. Studies in Hanalei Bay showed that variations in reef morphology relative to the orientation of the dominant meteorological and oceanographic forcing can generate heterogeneous waves and currents over relatively small (hundreds of meters) spatial scales, unlike those observed along relatively linear sandy shorelines (Hoeke et al., 2011; Storlazzi et al., 2009).  In reef environments where shallow reef crests limit the propagation of incoming surface wave energy, wave action alone may be insufficient to resuspend and disperse sediment, but in combination with wave- or wind-driven currents, orbital velocities may reach critical shear stress for sediment resuspension and dispersal (Ogston et al., 2004). By influencing orbital velocities, bed shear stress, and suspended sediment transport, current circulation is a strong control on the spatial distribution of sediment deposition, resuspension, and dispersal of terrigenous sediment discharged to the reef (Hoitink and Hoekstra, 2003; Presto et al., 2006; Storlazzi et al., 2004).")

document.add_paragraph("Studies in various coral reef environments adjacent high islands showed current speeds, directions, and residence times over reef flats are controlled by wave, wind, and tidal forcing, depending on the orientation and shape of the reef, relative to the prevailing wave, wind, and tidal climates (Hench et al., 2008; Hoeke et al., 2011; Presto et al., 2006; Storlazzi and Field, 2008; Storlazzi et al., 2004). Buoyancy forcing from hypopycnal river floods is generally ignored or considered inconsequential due to their rarity and short duration relative to other forcings (Hench et al., 2008; Hoeke et al., 2011).  Current speeds and patterns over reefs exposed to remotely-generated groundswells are generally dominated by wave forcing (Hench et al., 2008; Hoeke et al., 2011; Vetter et al., 2010), whereas wind forcing is dominant for reefs protected from groundswells (Presto et al., 2006). Tidal elevation modulates both wave-driven currents by controlling the reef crest depth and subsequent wave energy propagation into the reef flat, and wind-driven currents by regulating water depth for wind-driven surface wave development (Presto et al., 2006). Reef flat currents in wave-driven environments exhibit a pattern of rapid, cross-shore flow near the reef crest that slows moving shoreward and turns along-shore towards a deep channel where water returns seaward (Hench et al., 2008; Lowe et al., 2009; Wyatt et al., 2010). In wind-driven systems, current directions are more predominantly in the direction of the wind with possible cross-shore exchange from the reef flat to the forereef (Storlazzi et al., 2004). Observations on the reef flat in Molokai, Hawaii, showed current speeds were faster where the reef is deeper and narrower (Curt D Storlazzi et al., 2006) but field observations at the proposed study site suggest the opposite; current speeds are rapid over the shallow reef crest, slowing significantly when reaching deeper pools in the reef and the main channel that bisects the reef.")

document.add_paragraph("Understanding the current speeds, flow patterns, and residence time of water over the reef flat is critical for understanding spatial and temporal patterns of sedimentation in the study site, Faga'alu Bay, American Samoa. Following large or intense storm events, suspended sediment is discharged into Faga'alu Bay and advected seaward over the reef by momentum, in a thin surface layer of high suspended sediment concentration (SSC)(>500mg/L). This sediment-rich layer significantly attenuates photosynthetically active radiation (PAR) and transports fine sediment over the reef where it can settle out of the water column and onto coral organisms. Although the hypopycnal surface plume is able to move counter to prevailing currents (upcurrent) by sliding over denser seawater, as sediment particles settle they are entrained in the prevailing current and transported accordingly (Wolanski et al., 2003). As flow velocities increase, residence time of the plume over the reef flat decreases, limiting time for small particles to settle out of the water column and controlling the sedimentation rate, even for the same concentration and magnitude of different plumes.")

document.add_paragraph("Little data on current circulation around Tutuila is available, and almost no data on circulation over the reef flat has been collected (CH2M HILL, 1984; Jacob et al., 2012; Wiles et al., 2012). Militello et al. (2003) modeled wave-induced setup on reef flats and developed stage-frequency relationships for large tropical storms and hurricanes in American Samoa. Thompson and Demirbilek (2002) characterized offshore wave climate from data collected near Western Samoa (1985-1990), and used numerical modeling to simulate wave propagation dynamics in Pago Pago Harbor. Vetter et al (2013) deployed wave/tide gauges in Faga'alu Bay on the southern forereef and reef flat, and an ADCP in the 'ava, for one year (2012-2013). Vetter (2013) concluded flow dynamics in the bay were predominantly forced by waves breaking over the southern reef crest, and the wave influence increased linearly with tide height. Using an estimate of total lagoon volume, Vetter (2013) calculated flushing time varied from thirty-three hours during low wave height, to less than two hours during conditions when peak significant wave height was 1.6m, and mean current speed out of the main channel was 0.14 m/sec.")


#### STUDY AREA
study_area_title = document.add_heading('Study Area',level=2)

document.add_paragraph("Faga'alu Bay, Tutuila, American Samoa (14.290738 S, 170.677836 W) is a V-shaped, reef-fringed embayment at the mouth of a small, steep-sided watershed (2.48 km2)(Figure 1). An anthropogenically altered, vertical-walled, 10-20m deep channel ('ava in Samoan language) extends from the mouth of Faga'alu Stream eastward to the deep Pago Pago Bay. This deep channel divides the reef into a larger Southern and a smaller Northern section. A microtidal regime varies semi-diurnally from approximately 0 to 1m, exposing parts of the shallow reef crest and reef flat at extreme low tides (<0m MSL).")

## Study Area map
if 'Study_Area_map' in locals():
    document.add_picture(Study_Area_map['filename'],width=Inches(6))
    add_figure_caption(Study_Area_map['fig_num'],"Data collection locations in Faga'alu Bay. Wind speed and direction was recorded at the weather station (WxStation), a Dobie wave gauge recorded wave height and period (Wave Gauge), three ADCP's were deployed for one week to measure current speed and direction, and five GPS-logging drifters were deployed from the same five launch zones (DrifterLaunch) for thirty separate deployments (January to March, 2014). ")
    
document.add_paragraph("Faga'alu Bay is situated on the western side of Pago Pago Harbor, where it is protected by land from incoming swell from all directions except from the south to the east-south-east. The surrounding high topography blocks wet-season northerly winds (October-April), but the bay is exposed to dry-season southeasterly tradewinds and accompanying short-period wind waves (May-September). Faga'alu is only open to a narrow window of swell directions (S-SE) and swells approaching from a southerly angle must refract to the west to break directly on the reef, reducing the energy of breaking waves. Offshore significant wave heights (Hs) from southerly and southeasterly directions are generally less than 2.5m and rarely exceed 3m. Wave periods (Tp) are generally about 9 sec or less, rarely exceed 13 sec but occasionally reach 25 sec (Thompson and Demirbilek, 2002). Vetter (2013) recorded peak significant wave heights on the forereef in Faga'alu up to 1.7m but wave heights greater than 1m were rare. Given that the reef crest is nearly exposed at low tide, cross-reef transfer of water and wave energy is strongly dependent on the tidal stage and wave setup. ")
    
#### METHODS
methods_title = document.add_heading('Methods',level=2)

## Combining Eulerian and Lagrangian methods
document.add_heading('Combining Eulerian and Lagrangian methods',level=3)

if 'Drifter_ADCP_pics' in locals():
    document.add_picture(Drifter_ADCP_pics['filename'],width=Inches(6))
    add_figure_caption(Drifter_ADCP_pics['fig_num']," Drifter and ADCP deployment.")

document.add_paragraph("While Vetter (2013) used wave/tide data and current speed in the main channel to calculate flushing time, those calculations are highly dependent on the estimation of total volume in the bay and reliant on bathymetry data which is not well verified. Calculations of flushing time also do not provide information on the spatial distribution of flow speeds or specific flow paths over the reef. Since it is known that residence time of water, in addition to water quality, is a strong control on coral health, it is desirable to characterize spatially distributed residence times in relation to wave, wind, and tide forcings.")

document.add_paragraph("To characterize the spatial pattern of flows over the reef flat in Faga'alu Bay, and determine the relationship between offshore wave forcing and residence time of water over the reef flat, a combination of Eulerian and Lagrangian measurements is used. In fluid dynamics there are two ways to quantify the flow field: 1) the Lagrangian perspective observes an individual fluid parcel as it moves through space and time, 2) the Eulerian perspective focuses on specific locations, observing the fluid flow past that location over time. Eulerian methods characterize water circulation on the reef using bottom-mounted instruments to record wave height and period, current speed and direction, and/or tidal elevation (Presto et al., 2006; Storlazzi et al., 2009), however, collecting high spatial resolution data of hydrodynamic processes using strictly Eulerian methods is expensive and logistically difficult (Curt D. Storlazzi et al., 2006; Storlazzi et al., 2004). While imagery-based remote sensing is useful to map the temporal and spatial distribution of flood plume boundaries (Klemas, 2012; Warrick et al., 2007), the underlying current circulation is a strong control on sediment transport that may not be quantified by even high resolution remote sensing of plumes. Spatially distributed wave height, current speeds, and flow patterns can be predicted by hydrodynamic computer models (Hoeke et al., 2011), but models typically require accurate bathymetry, detailed forcing data, and significant modeling expertise (Hoeke, 2010; King et al., 2012; Wolanski et al., 2009).  Lagrangian methods including the use of GPS-tracking drifters have been used to map flow patterns over reef flats to compare to Eulerian descriptions of flow speeds (C. D. Storlazzi et al., 2006; Storlazzi et al., 2004; Wyatt et al., 2012) or validate hydrodynamic computer models (Ouillon et al., 2010).")
## Lagrangian measurements (GPS-logging drifters)
document.add_heading('Lagrangian measurements (GPS-logging drifters)',level=4)
document.add_paragraph("GPS-tracking drifters have been traditionally used to characterize oceanic circulation in the deep or coastal ocean (Davis, 1991; Warrick et al., 2007), but cheaper, smaller GPS technology has recently made it possible to deploy many small drifters in nearshore environments to map flow patterns at finer spatiotemporal resolution (Austin and Atkinson, 2004; Johnson et al., 2003; MacMahan et al., 2010). Research on rip currents in beach surf zones have shown the ability to capture synoptic measurements of small-scale flow structures and patterns by deploying large numbers of GPS-logging drifters to collect high-density observations of flow speeds and directions (Johnson et al., 2003; MacMahan et al., 2010). While deploying a fleet of GPS-logging drifters has yielded synoptic measurements of water movement in surf zones near linear, sandy beaches, it has not been attempted in a shallow reef environment. ")

document.add_paragraph("Drifter studies in nearshore environments are typically limited in number of drifters, number of deployments, and the range of oceanic and meteorological conditions experienced during deployments, making it uncertain whether they describe the dominant patterns, or short-lived anomalies (C. D. Storlazzi et al., 2006; Wyatt et al., 2010).  While Lagrangian measurements provide spatially explicit data on the flow field, observations are limited temporally by their short duration times relative to Eulerian methods like in situ current meters. Storlazzi et al., (2006) compared Lagrangian drifter tracks with progressive vectors of cumulative flow calculated from Eulerian current meters to determine if short-term observations from drifters were representative of the dominant patterns.")

## Analytical Methods
document.add_heading('Analytical Methods',level=4)
document.add_paragraph("")

## Forcing: Wave, Wind and Tide data
document.add_heading('Forcing: Wave, Wind and Tide data',level=3)
document.add_paragraph("A NIWA Dobie-A wave/tide gauge (DOBIE) was deployed on the southern reef slope at 10m depth, and recorded a 512s burst at 2Hz at the top of every hour. The DOBIE malfunctioned and recorded no data coinciding with the ADCP deployment, but showed good comparison with NOAA WaveWatchIII (WW3) modeled data on swell height and direction. Swell height and direction output from WW3 will be used to characterize wave forcing in further analyses (Hoeke et al., 2011).")

document.add_paragraph("Meteorological data during the study were obtained from a Davis VantagePro weather station installed near the stream mouth, approximately 5m above sea level on a pole mounted to a building (WxStation, Figure 1). Wind speed, wind direction, barometric pressure, and precipitation were recorded at 15min. intervals at the weather station. Meteorological and tide data was also recorded at a NOAA NDBC station (NSTP6), 1.8km north, during the study. Wind speed, wind direction, barometric pressure, and water level were recorded at NSTP6 at 6min. intervals. For this study, wind conditions are sufficiently described by qualitatively so the topographic effects on wind speed and direction recorded at the stations are considered inconsequential (Storlazzi et al., 2004)")



#### RESULTS and DISCUSSION ####
results_title = document.add_heading('Results and Discussion',level=2)
## Forcing: Wave, wind, tide during ADCP deployment
document.add_heading('Forcing: Wave, wind, tide during ADCP deployment',level=3)

document.add_paragraph("A fairly large range of wind and wave conditions and combinations was sampled during the ADCP deployment (February 15-23, 2014), including a high onshore wind event, a high SE groundswell event, and low to moderate winds from variable directions. The deployment period of the ADCP and intensive drifter deployments can be separated into three distinct time periods: 1) Low swell, High onshore wind (Day 47-49)="+'"WIND"'+", 2) Low swell, Low wind (Day 50-51)="+'"CALM"'+", and 3) High swell, Low wind (Day 52-Day 55)="+'"WAVE"'+" (Figure 3). Average wind speed reached a maximum of 9m/s (17knots) with maximum gusts of to 14m/s (28knots) from the NE-SE on February 17, 2014 (Day 48). Swell height during WAVE reached 1.3m (Day 52), which is near the annual maximum height expected for this location (Vetter, 2013).")

## Table: End member definitions
if 'Endmember_table' in locals():
    dataframe_to_table(df=Endmember_table,table_num=Endmember_table.table_num,caption="End member periods",fontsize=9)
document.add_paragraph("**Note: Local time is UTC-11 so local dates are actually one day earlier (e.g. Tide=2/18-2/19 Local time)")

### Forcing data
if 'Forcing_data_timeseries' in locals():
    document.add_picture(Forcing_data_timeseries['filename'],width=Inches(6))
    add_figure_caption(Forcing_data_timeseries ['fig_num'],caption="Forcing: Tide, wind speed, wind direction from NDBC station NSTP6, wave height and direction from NOAA WW3. Day 47=16 Feb 2014, Day 54=23 Feb 2014.")

## Eulerian Measurements (ADCP)    
document.add_heading('Eulerian Measurements (Acoustic Doppler Current Profilers)',level=3)
document.add_paragraph("Three Nortek Aquadopp ADCP were supplied by the USGS Pacific Water Science Center in Santa Cruz, CA, and deployed on the reef flat in Faga'alu for one week: February 15-23, 2014 (Figure 1). Flow speed and direction was recorded every 20 minutes at 1hz (not sure what the actual specs were, Curt programmed them). On the Northern reef the water level dropped below the minimum blanking distance of the ADCP at low tides, and flow is assumed to be nearly zero during these times given the relatively low water.")

## ADCP measurements
if 'ADCP_measurements' in locals():
    document.add_picture(ADCP_measurements['filename'],width=Inches(6))
    add_figure_caption(ADCP_measurements['fig_num'],caption="ADCP measurements.")    


## Lagrangian Measurements (GPS-logging Drifters)
document.add_heading('Lagrangian Measurements (GPS-logging Drifters)',level=3)
document.add_paragraph("Drifter designs typically involve the use of a suspended drogue (Johnson et al., 2003; Ouillon et al., 2010) or a finned tube (MacMahan et al., 2009) to extend into and anchor the drifter in the water column, however, due to the shallow conditions experienced on reef flats a novel drifter design was needed. Drifters for shallow coral reef environments need to be shallow enough to avoid interaction with corals, deep enough to not be affected by the surface movements, extend high enough to be visible but not high enough to be affected by winds, and finally, rugged enough to sustain the impact of a breaking wave onto corals in the event it is entrained in the surf zone.")

document.add_paragraph("Faga'alu Bay is a relatively small area (0.25km2) so very high density drifter data could be collected with a small number of drifters (n=5) and field personnel (n=1). Five drifters were designed and constructed on-island, from PVC tubing and plastic sheeting, with a small waterproof housing for the GPS recorder (HOLUX M1000), and a float collar to maintain upright orientation (Figure 2). Deployments were conducted sporadically to capture "+'"end-member"'+" conditions for all combinations of High-Low waves, High-Low wind (offshore and onshore), and High-Low tide. Multiple daily deployments were scheduled during one randomly selected week coinciding with ADCP deployment to facilitate direct comparisons of Eulerian and Lagrangian flow measurements under various forcing conditions. Thirty deployments were conducted, with twenty-two of those deployments coinciding with ADCP deployment (Table 1). Drifter velocities and trajectories are calculated using a forward-difference scheme on the drifter locations (Davis, 1991; MacMahan et al., 2010).")


## Table: Drifter deployments dates and conditions
if 'Drifter_deployment_table' in locals():
    dataframe_to_table(df=Drifter_deployment_table,table_num=Drifter_deployment_table.table_num,caption="Drifter deployment dates and conditions. Red numbered Deployments coincide with ADCP deployment",fontsize=9)
document.add_paragraph("")

document.add_paragraph("Five drifters were released from the same five launch zones (Figure 1) at the beginning of each of thirty deployments from January to February, 2014. Drifter position data was recorded by the HOLUX-M1000 GPS logger at 5 second intervals and resampled to 1 minute intervals to reduce signal noise. Drifter speed and bearing were calculated from point to point and gridded by ")

## Comparing Eulerian and Lagrangian Measurements
document.add_heading('Comparing Eulerian and Lagrangian Measurements',level=3)

# Specific flow patterns under Wind, Wave, and Calm Conditions
document.add_heading('Specific flow patterns under Wind, Wave, and Calm Conditions',level=4)
document.add_paragraph("Data were categorized into wind, wave, and calm "+'"end-member"'+" conditions (Presto et al., 2006)")

if 'Progressive_Vectors_ADCP_vs_Drifters' in locals():
    document.add_picture(Progressive_Vectors_ADCP_vs_Drifters['filename'],width=Inches(6))
    add_figure_caption(Progressive_Vectors_ADCP_vs_Drifters['fig_num'],caption="Progressive vectors from ADCP compared to actual Drifter tracks") 

document.add_heading('Mean flow speed and direction in 100m gridded cells under Wind, Wave, Calm conditions',level=4)
document.add_paragraph("Arrows with speed=size (Presto et al., 2006); Drifter data are binned by location (10m x 10m bins) and averaged over the deployment duration (~1 hr) to obtain a synoptic view of the flow pattern (MacMahan et al., 2010).; Similar bay in Guam showed max speed in channel of 0.05m/s (Wolanski et al., 2003);  Current speeds, waves, and setup higher during higher tide stages (Storlazzi et al., 2004)")

## Gridded velocity by endmembers
if 'Gridded_Velocity_endmembers' in locals():
    document.add_picture(Gridded_Velocity_endmembers['filename'],width=Inches(6))
    add_figure_caption(Gridded_Velocity_endmembers['fig_num'],caption="Drifter tracks and gridded mean velocity.") 

## PCA Plots of all drifter data, in 100m bins, color ellipses by number of observations
document.add_heading('PCA Plots of all drifter data, in 100m bins, color ellipses by number of observations',level=4)

## Gridded PCA by endmembers
if 'PCA_gridded' in locals():
    document.add_picture(PCA_gridded['filename'],width=Inches(6))
    add_figure_caption(PCA_gridded['fig_num'],caption="Gridded PCA compared to ADCP")    


document.add_paragraph("")
document.add_paragraph("")
document.add_paragraph("")
document.add_paragraph("")
document.add_paragraph("")
document.add_paragraph("")


#### CONCLUSION
conclusion_title=document.add_heading('Conclusion',level=2)
conclusion_text = document.add_paragraph("In conclusion...")

#### Appendix
document.add_page_break()
document.add_heading('APPENDIX',level=2)
## Appendix stuff goes here...

## Save Document
document.save(maindir+'Manuscript/DRAFT-Fagaalu_water_circulation.docx')

## Clean up any open figures
plt.close('all')

